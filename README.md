# ü§ñ –ò–ò-–ò–≤–∞–Ω - Advanced Legal AI Assistant

–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —Å enterprise-level –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.

## üÜï –û–°–ù–û–í–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
- ‚úÖ **–í—Ö–æ–¥–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ó–∞—â–∏—Ç–∞ –æ—Ç XSS, SQL injection, —Å–ø–∞–º-–∞—Ç–∞–∫
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∞–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ **Connection Pooling**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ aiosqlite
- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤**: Redis/in-memory –∫–µ—à –¥–ª—è OpenAI –æ—Ç–≤–µ—Ç–æ–≤

### üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ **Background cleanup**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ **Health checks**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **Horizontal scaling**: Service registry, load balancing, session affinity

### üõ°Ô∏è **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**
- ‚úÖ **Graceful degradation**: Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis
- ‚úÖ **Recovery mechanisms**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚úÖ **Circuit breakers**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
- ‚úÖ **Distributed locks**: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üíº **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- üîç –ê–Ω–∞–ª–∏–∑ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞ –∏ —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏
- üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- üí° –ü—Ä–∞–≤–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤
- ‚ö° –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—é
- üéØ –ö—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏

### üîß **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤**
- üìä **Prometheus –º–µ—Ç—Ä–∏–∫–∏** –Ω–∞ –ø–æ—Ä—Ç—É 8000
- üè• **Health checks** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üìà **Detailed logging** —Å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üîÑ **Background tasks** –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- üéõÔ∏è **Flexible configuration** —á–µ—Ä–µ–∑ environment variables

### üèóÔ∏è **–î–ª—è DevOps**
- üîÑ **Horizontal scaling** —Å service discovery
- ‚öñÔ∏è **Load balancing** —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
- üîê **Session affinity** –¥–ª—è sticky sessions
- üê≥ **Docker-ready** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚ò∏Ô∏è **Kubernetes-ready** —Å health endpoints

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **Core Stack**
- `aiogram` v3 - Telegram Bot API
- `openai` v1.40+ - AI responses —Å –Ω–æ–≤—ã–º Responses API
- `aiosqlite` - Async database —Å connection pooling
- `redis` - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
- `prometheus-client` - –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- `psutil` - –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–ú–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã**
```
src/
‚îú‚îÄ‚îÄ core/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ validation.py        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py        # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ db_advanced.py       # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å pooling
‚îÇ   ‚îú‚îÄ‚îÄ cache.py             # –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ background_tasks.py  # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py           # Prometheus –º–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ health.py            # Health checks
‚îÇ   ‚îî‚îÄ‚îÄ scaling.py           # Horizontal scaling
‚îú‚îÄ‚îÄ bot/                     # Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îî‚îÄ‚îÄ telegram_legal_bot/      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### **–ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
```bash
git clone <repo> && cd AIVAN
poetry install
cp config.example.env .env
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ TELEGRAM_BOT_TOKEN –∏ OPENAI_API_KEY
```

### **Production —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
```bash
# –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ –≤—Å–µ–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
poetry install --extras full

# –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
poetry install --extras monitoring

# –¢–æ–ª—å–∫–æ scaling
poetry install --extras scaling
```

### **Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
```bash
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
docker build -t ai-ivan .
docker run -d --env-file .env ai-ivan

# –° Redis –∏ Prometheus
docker-compose up -d
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_token
OPENAI_API_KEY=your_key

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
USE_ADVANCED_DB=1
DB_MAX_CONNECTIONS=5

# –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
ENABLE_OPENAI_CACHE=1
REDIS_URL=redis://localhost:6379/0
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
```env
# Prometheus –º–µ—Ç—Ä–∏–∫–∏
ENABLE_PROMETHEUS=1
PROMETHEUS_PORT=8000

# Health checks
HEALTH_CHECK_INTERVAL=30.0
ENABLE_SYSTEM_MONITORING=1
```

### **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
```env
# Horizontal scaling
ENABLE_SCALING=1
HEARTBEAT_INTERVAL=15.0
SESSION_AFFINITY_TTL=3600
```

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

### **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫
poetry run python run_simple_bot.py

# –° –ø–æ–ª–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
LOG_LEVEL=DEBUG poetry run python run_simple_bot.py
```

### **Production**
```bash
# –ë–∞–∑–æ–≤–∞—è production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
USE_ADVANCED_DB=1 ENABLE_PROMETHEUS=1 poetry run python run_simple_bot.py

# –ü–æ–ª–Ω–∞—è production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
docker-compose -f docker-compose.prod.yml up -d
```

### **–ö–ª–∞—Å—Ç–µ—Ä**
```bash
# –ü–µ—Ä–≤–∞—è –Ω–æ–¥–∞
ENABLE_SCALING=1 NODE_ID=node-1 PORT=8001 poetry run python run_simple_bot.py

# –í—Ç–æ—Ä–∞—è –Ω–æ–¥–∞  
ENABLE_SCALING=1 NODE_ID=node-2 PORT=8002 poetry run python run_simple_bot.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **Prometheus –º–µ—Ç—Ä–∏–∫–∏**
- `http://localhost:8000/metrics` - –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏
- –°—á–µ—Ç—á–∏–∫–∏: telegram_messages_total, openai_requests_total
- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã: response_time, database_query_duration
- Gauges: active_sessions, database_connections

### **Health checks**
- `GET /health` - –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- `GET /health/database` - –°—Ç–∞—Ç—É—Å –ë–î
- `GET /health/openai` - –°—Ç–∞—Ç—É—Å OpenAI
- `GET /health/redis` - –°—Ç–∞—Ç—É—Å Redis

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –ª–æ–≥–∏
LOG_JSON=1 poetry run python run_simple_bot.py

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
LOG_LEVEL=INFO poetry run python run_simple_bot.py | jq 'select(.logger | contains("openai"))'
```

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**
- **Database cleanup**: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–∫–∞–∂–¥—ã–π —á–∞—Å)
- **Cache cleanup**: –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–µ–≥–æ –∫–µ—à–∞ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- **Session cleanup**: –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
- **Health monitoring**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
curl http://localhost:8000/health

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
curl http://localhost:8000/metrics | grep error

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
tail -f logs/ai-ivan.log | jq 'select(.lvl == "ERROR")'
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–ë–µ–Ω—á–º–∞—Ä–∫–∏**
- **–ë–µ–∑ –∫–µ—à–∞**: ~2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å OpenAI
- **–° –∫–µ—à–µ–º**: ~50-100ms –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- **Connection pooling**: –¥–æ 3x —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Memory usage**: ~50-100MB –≤ –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
- **Advanced DB**: Connection pooling, WAL mode, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **Smart caching**: –°–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤, TTL, LRU eviction
- **Background cleanup**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **Graceful degradation**: Fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ external —Å–µ—Ä–≤–∏—Å–æ–≤

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π**
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –≤ `src/core/`
2. –î–æ–±–∞–≤—å—Ç–µ health check –≤ `src/core/health.py`
3. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ `src/core/metrics.py`
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ `src/core/main_simple.py`

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
poetry install --with dev

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
poetry run pytest

# –õ–∏–Ω—Ç–∏–Ω–≥
poetry run ruff check
poetry run black --check .
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
