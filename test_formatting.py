#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Тест улучшенного форматирования текста
"""

import sys
import os

# Исправляем кодировку для Windows
if sys.platform.startswith('win'):
    import codecs
    sys.stdout = codecs.getwriter('utf-8')(sys.stdout.buffer, 'strict')
    os.environ['PYTHONIOENCODING'] = 'utf-8'

from src.bot.ui_components import render_legal_html

# Ваш исходный текст
test_text = """1 Блок. Краткий ответ- Расторжение договора аренды возможно несколькими путями:по взаимному согласию сторон;досрочно по основаниям, предусмотренным ГК РФ и/или ЖК РФ (например, нарушение условий договора одной из сторон, существенное нарушение, просрочки платежей, утрата предмета и т.п.);через суд — если согласовать расторжение не удаётся или есть спор об условиях выселения/возврата имущества.Чтобы дать конкретную инструкцию и подготовить документы, нужно уточнить детали: какая именно недвижимость в договоре (жилое помещение, коммерческая площадь, объект недвижимости), какая сторона хочет расторгнуть договор, какие нарушения/обстоятельства имеются, есть ли уведомления и пр.Итого: дам точный план действий и шаблоны документов под ваши условия после уточнений.2 Блок. Подробный разбор ситуации с ссылками на НПА- Что именно нужно выяснить (для выбора варианта и подготовки документов):Тип аренды: жилое помещение, коммерческая аренда, иное имущество?Кто инициатор расторжения: арендодатель или арендатор?Срок и характер договора: срочный/бессрочный, есть ли уведомления о расторжении?Наличие нарушений: просрочки оплаты, нарушение правил пользования, субаренда без разрешения, порча имущества и т. п.?Наличие депозитов, возврата арендной платы и расходов на ремонт.Варианты развёртывания ситуации:Вариант A — расторжение по соглашению сторон:Как оформить: простое письменное соглашение об расторжении, в котором прописываются дата расторжения, порядок сдачи объекта, возврат депозита, расчёты по задолженностям и акт приёма-передачи.Нормативная база: можно опираться на общие принципы ГК РФ о договоре аренды (ГК РФ) и положения о расторжении договоров по соглашению сторон.Преимущества: минимальные риски, быстрое прекращение, отсутствие судебных затрат.ВАЖНО: все документы должны быть оформлены в письменном виде.Например: можно использовать типовые формы договоров.Согласно статье 610 ГК РФ расторжение возможно по взаимному согласию."""

if __name__ == "__main__":
    print("=== Тестирование форматирования ===")
    print("Исходный текст: " + str(len(test_text)) + " символов")

    formatted = render_legal_html(test_text)

    # Сохраняем в файл
    with open('formatted_result.html', 'w', encoding='utf-8') as f:
        f.write("=== Отформатированный HTML ===\n")
        f.write(formatted)
        f.write("\n\n=== Как будет выглядеть в Telegram ===\n")

        # Показываем как это будет выглядеть (без HTML тегов)
        import re
        plain = re.sub(r'<[^>]+>', '', formatted)
        plain = plain.replace('<br><br>', '\n\n').replace('<br>', '\n')
        f.write(plain)

    print("Результат сохранен в файл: formatted_result.html")
    print("HTML теги найдены:", bool(re.search(r'<[^>]+>', formatted)))
    print("Количество символов после форматирования:", len(formatted))