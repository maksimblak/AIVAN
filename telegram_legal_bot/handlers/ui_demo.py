# telegram_legal_bot/handlers/ui_demo.py
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ UI.
"""

from __future__ import annotations

from aiogram import Router, types, F
from aiogram.filters import Command

from telegram_legal_bot.utils.message_formatter import md2
from telegram_legal_bot.ui.messages import BotMessages
from telegram_legal_bot.ui.animations import BotAnimations
from telegram_legal_bot.ui.user_profile import user_profile_manager

router = Router(name="ui_demo")


@router.message(Command("demo"))
async def cmd_demo(msg: types.Message) -> None:
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ UI."""
    try:
        demo_text = """
üé® **–î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ù–û–í–û–ì–û UI**

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π AIVAN! 

‚ú® **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ –ö—Ä–∞—Å–∏–≤—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—é
‚Ä¢ –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π  
‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚Ä¢ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ –æ—Ü–µ–Ω–∫–∏

üöÄ **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ!**
        """.strip()
        
        await msg.answer(
            md2(demo_text),
            parse_mode="MarkdownV2"
        )
    except Exception:
        fallback_text = "üé® –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ UI –¥–æ—Å—Ç—É–ø–Ω–∞!"
        await msg.answer(fallback_text, parse_mode=None)


@router.message(Command("animate"))
async def cmd_animate(msg: types.Message) -> None:
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π."""
    try:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        await BotAnimations.typing_animation(msg, 2.0)
        
        # –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        await BotAnimations.loading_dots(msg, "‚è≥ **–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏**", 3.0)
        
        # –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        steps = [
            "üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...",
            "üìä –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...", 
            "üé® –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π...",
            "‚úÖ **–ê–Ω–∏–º–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞!**"
        ]
        
        await BotAnimations.progress_message(msg, steps, delay=1.5)
        
        # –§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
        await BotAnimations.celebration_effect(msg, "–ê–Ω–∏–º–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ!")
        
    except Exception:
        await msg.answer("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")


@router.message(Command("profile_demo"))
async def cmd_profile_demo(msg: types.Message) -> None:
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ñ–∏–ª–µ–π."""
    try:
        user_id = msg.from_user.id if msg.from_user else 0
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        user_profile_manager.add_question(user_id, "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –¥–µ–º–æ", "civil")
        user_profile_manager.add_feedback(user_id, True)
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É  
        stats = user_profile_manager.get_stats(user_id)
        
        profile_text = BotMessages.profile(stats)
        await msg.answer(
            md2(profile_text),
            parse_mode="MarkdownV2"
        )
        
    except Exception:
        await msg.answer("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")


@router.message(Command("test_format"))
async def cmd_test_format(msg: types.Message) -> None:
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–π."""
    try:
        # HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        html_text = """
üß™ <b>–¢–ï–°–¢ HTML –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø</b>

‚úÖ <b>–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b> - —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ <i>–ö—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç</i> - —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ <u>–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç</u> - —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ <code>–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</code> - —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ <pre>–ë–ª–æ–∫ –∫–æ–¥–∞</pre> - —Ä–∞–±–æ—Ç–∞–µ—Ç

üé® <b>–≠–º–æ–¥–∑–∏ –∏ —Å–∏–º–≤–æ–ª—ã:</b>
‚Ä¢ –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: & < > "
‚Ä¢ –í–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏!
‚Ä¢ –î–≤–æ–µ—Ç–æ—á–∏—è: —Ä–∞–±–æ—Ç–∞—é—Ç

<b>–í—ã–≤–æ–¥:</b> HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–µ–µ MarkdownV2!
        """.strip()
        
        await msg.answer(html_text, parse_mode="HTML")
        
        # MarkdownV2 –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        md2_text = """
üß™ *–¢–ï–°–¢ MARKDOWNV2 –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø*

‚úÖ *–ö—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç* \\- —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ `–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç` \\- —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ ||–°–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç|| \\- —Ä–∞–±–æ—Ç–∞–µ—Ç

‚ö†Ô∏è *–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–º–≤–æ–ª–∞–º–∏:*
‚Ä¢ –ù—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å: \\! \\. \\- \\( \\)
‚Ä¢ –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
‚Ä¢ –õ–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ

*–í—ã–≤–æ–¥:* MarkdownV2 —Å–ª–æ–∂–Ω–µ–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏\\!
        """.strip()
        
        await msg.answer(md2_text, parse_mode="MarkdownV2")
        
    except Exception as e:
        await msg.answer(f"–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {str(e)}")


@router.message(Command("ui_info"))
async def cmd_ui_info(msg: types.Message) -> None:
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ–º UI."""
    try:
        info_text = """
‚ÑπÔ∏è **–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ù–û–í–û–ú UI**

üé® **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:**
‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—é
‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚Ä¢ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

**–°–æ–æ–±—â–µ–Ω–∏—è:**
‚Ä¢ –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚Ä¢ –≠–º–æ–¥–∑–∏ –∏ –∏–∫–æ–Ω–∫–∏
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–∞—á–∞

**–ê–Ω–∏–º–∞—Ü–∏–∏:**
‚Ä¢ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏
‚Ä¢ –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

**–ü—Ä–æ—Ñ–∏–ª–∏:**
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:**
‚Ä¢ –û—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
‚Ä¢ –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

üöÄ **–í—Å–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!**
        """.strip()
        
        await msg.answer(md2(info_text), parse_mode="MarkdownV2")
        
    except Exception:
        fallback_text = """
‚ÑπÔ∏è –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ù–û–í–û–ú UI

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–∞–µ—Ç:
‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—é
‚Ä¢ –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è  
‚Ä¢ –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
‚Ä¢ –°–∏—Å—Ç–µ–º—É –ø—Ä–æ—Ñ–∏–ª–µ–π
‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å

–í—Å–µ –¥–ª—è –≤–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞!
        """.strip()
        
        await msg.answer(fallback_text, parse_mode=None)


## –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ inline-–∫–Ω–æ–ø–∫–∏ –∏ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é: –Ω–µ—Ç –∫–Ω–æ–ø–æ–∫, —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç—ã.
